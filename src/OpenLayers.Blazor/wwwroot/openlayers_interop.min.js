var _MapOL=new Array;function MapOLInit(e,t,o,r,n,a,i,s,p,c){_MapOL[e]=new MapOL(e,t,o,r,n,a,i,s,p,c)}function MapOLDispose(e){_MapOL[e]=void 0}function MapOLCenter(e,t){_MapOL[e].setCenter(t)}function MapOLRotate(e,t){_MapOL[e].setRotation(t)}function MapOLZoom(e,t){_MapOL[e].setZoom(t)}function MapOLSetOptions(e,t){_MapOL[e].setOptions(t)}function MapOLZoomToExtent(e,t,o){_MapOL[e].setZoomToExtent(t,o)}function MapOLSetShapes(e,t,o){_MapOL[e].setShapes(t,o)}function MapOLCenterToCurrentGeoLocation(e){_MapOL[e].centerToCurrentGeoLocation()}function MapOLGetCurrentGeoLocation(e){return _MapOL[e].getCurrentGeoLocation()}function MapOLSetLayers(e,t){_MapOL[e].setLayers(t)}function MapOLRemoveLayer(e,t){_MapOL[e].removeLayer(t)}function MapOLAddLayer(e,t){_MapOL[e].addLayer(t)}function MapOLUpdateLayer(e,t){_MapOL[e].updateLayer(t)}function MapOLSetVisibleExtent(e,t){_MapOL[e].setVisibleExtent(t)}function MapOLSetDrawingSettings(e,t,o,r,n,a,i){_MapOL[e].setDrawingSettings(t,o,r,n,a,i)}function MapOLUndoDrawing(e){_MapOL[e].undoDrawing()}function MapOLUpdateShape(e,t,o){_MapOL[e].updateShape(t,o)}function MapOLRemoveShape(e,t,o){_MapOL[e].removeShape(t,o)}function MapOLAddShape(e,t,o){_MapOL[e].addShape(t,o)}function MapOLGetCoordinates(e,t,o){return _MapOL[e].getCoordinates(t,o)}function MapOLSetCoordinates(e,t,o,r){return _MapOL[e].setCoordinates(t,o,r)}function MapOLSetInteractions(e,t){_MapOL[e].setInteractions(t)}function MapOLSetSelectionSettings(e,t,o,r,n){_MapOL[e].setSelectionSettings(t,o,r,n)}function MapOLShowPopup(e,t){_MapOL[e].showPopup(t)}function MapOLApplyMapboxStyle(e,t,o){_MapOL[e].applyMapboxStyle(t,o)}function MapOL(e,t,o,r,n,a,i,s,p,c){this.Instance=p,this.Options=o;p=new ol.proj.Projection({code:"EPSG:21781",extent:[485869.5728,76443.1884,837076.5648,299941.7864],units:"m"}),ol.proj.addProjection(p),o=new ol.proj.Projection({code:"EPSG:2056",extent:[2485071.58,1074261.72,2837119.8,1299941.79],units:"m"}),ol.proj.addProjection(o),ol.proj.addCoordinateTransforms("EPSG:4326",p,function(e){return[MapOL.WGStoLV03y(e[1],e[0]),MapOL.WGStoLV03x(e[1],e[0])]},function(e){return[MapOL.CHtoLV03lng(e[0],e[1]),MapOL.CHtoLV03lat(e[0],e[1])]}),ol.proj.addCoordinateTransforms("EPSG:4326",o,function(e){return[MapOL.WGStoLV95y(e[1],e[0]),MapOL.WGStoLV95x(e[1],e[0])]},function(e){return[MapOL.LV95toWGSlng(e[0],e[1]),MapOL.LV95toWGSlat(e[0],e[1])]}),this.Options.coordinatesProjection||(this.Options.coordinatesProjection="EPSG:4326"),s=this.prepareLayers(s);let l=0<s.length?s[0].getSource().getProjection():void 0;var u=0<s.length?s[0].getExtent():void 0;let g=r||void 0;l=this.Options.viewProjection||l||("EPSG:2056"==this.Options.coordinatesProjection?o:"EPSG:21781"==this.Options.coordinatesProjection?p:"EPSG:3857"),g=g&&ol.proj.transform(g,this.Options.coordinatesProjection,l),this.Map=new ol.Map({layers:s,target:e,controls:[],view:new ol.View({projection:l,center:g,extent:u,zoom:n,rotation:a,maxZoom:this.Options.maxZoom,minZoom:this.Options.minZoom}),interactions:ol.interaction.defaults.defaults().extend([new ol.interaction.DragRotateAndZoom])}),this.addControls();var h=this,d=document.getElementById(t);if(this.OverlayPopup=new ol.Overlay({element:d,positioning:"bottom-center",stopEvent:!1,offset:[0,-50]}),this.Map.addOverlay(this.OverlayPopup),this.setInteractions(i),this.setSelectionSettings(!0),c)try{var y=c.split("."),M=y.pop(),f=window;for(let e=0;e<y.length;e++)f=f[y[e]];f[M].apply(f,[this.Map])}catch(e){console.error(e)}this.Map.on("click",function(e){h.onMapClick(e,h.OverlayPopup,d)}),this.Map.on("dblclick",function(e){h.onMapDblClick(e)}),this.Map.on("pointermove",function(e){h.onMapPointerMove(e)}),this.Map.on("rendercomplete",function(e){h.Instance.invokeMethodAsync("OnInternalRenderComplete")}),this.Map.getView().on("change:resolution",function(e){h.onMapResolutionChanged()}),this.Map.getView().on("change:center",function(e){h.onMapCenterChanged()}),this.Map.getView().on("change:rotation",function(e){h.onMapRotationChanged()}),this.onMapCenterChanged()}MapOL.prototype.prepareLayers=function(e){let c=new Array,l=this;return e.forEach((o,e,t)=>{try{let e;var r,n,a,i,p=o.source.sourceType;switch(o.options&&delete(o=Object.assign(o,o.options)).options,o.source&&o.source.options&&(o.source=Object.assign(o.source,o.source.options),delete o.source.options),(o=MapOL.transformNullToUndefined(o)).extent&&this.Options.coordinatesProjection&&(r=l.Options.viewProjection??(0<c.length?c[0].getSource().getProjection():"EPSG:3857"),o.extent=ol.proj.transformExtent(o.extent,o.source.projection??l.Options.coordinatesProjection,r)),p){case"TileImage":e=new ol.source.TileImage(o.source);break;case"BingMaps":e=new ol.source.BingMaps(o.source);break;case"OGCMapTile":e=new ol.source.OGCMapTile(o.source);break;case"TileArcGISRest":e=new ol.source.TileArcGISRest(o.source);break;case"TileJSON":e=new ol.source.TileJSON(o.source);break;case"TileWMS":e=new ol.source.TileWMS(o.source);break;case"WMTS":e=new ol.source.WMTS(o.source);break;case"Zoomify":e=new ol.source.Zoomify(o.source);break;case"OSM":e=new ol.source.OSM(o.source);break;case"XYZ":e=new ol.source.XYZ(o.source);break;case"CartoDB":e=new ol.source.CartoDB(o.source);break;case"Stamen":e=new ol.source.Stamen(o.source);break;case"StadiaMaps":e=new ol.source.StadiaMaps(o.source);break;case"TileDebug":e=new ol.source.TileDebug(o.source);break;case"VectorKML":o.source.format=new ol.format.KML(o.source.formatOptions);break;case"VectorEsriJson":o.source.format=new ol.format.EsriJSON(o.source.formatOptions);break;case"VectorGeoJson":o.source.format=new ol.format.GeoJSON(o.source.formatOptions);break;case"VectorTopoJson":o.source.format=new ol.format.TopoJson(o.source.formatOptions);break;case"VectorMVT":o.source.format=new ol.format.MVT(o.source.formatOptions);break;case"VectorIGC":o.source.format=new ol.format.IGC(o.source.formatOptions);break;case"VectorPolyline":o.source.format=new ol.format.Polyline(o.source.formatOptions);break;case"VectorWKT":o.source.format=new ol.format.WKT(o.source.formatOptions);break;case"VectorWKB":o.source.format=new ol.format.WKB(o.source.formatOptions);break;case"VectorGML2":o.source.format=new ol.format.GML2(o.source.formatOptions);break;case"VectorGML3":o.source.format=new ol.format.GML3(o.source.formatOptions);break;case"VectorGPX":o.source.format=new ol.format.GPX(o.source.formatOptions);break;case"VectorOSMXML":o.source.format=new ol.format.OSMXML(s);break;case"VectorWFS":o.source.format=new ol.format.WFS(o.source.formatOptions);break;case"ImageArcGISRest":e=new ol.source.ImageArcGISRest(o.source);break;case"ImageCanvasSource":e=new ol.source.ImageCanvasSource(o.source);break;case"ImageMapGuide":e=new ol.source.ImageMapGuide(o.source);break;case"ImageStatic":o.extent&&!o.source.imageExtent&&(o.source.imageExtent=o.extent),e=new ol.source.ImageStatic(o.source);break;case"ImageWMS":e=new ol.source.ImageWMS(o.source)}switch(o.layerType){case"Image":o.source=e,n=new ol.layer.Image(o);break;case"Vector":case"VectorTile":o.useStyleCallback?o.style=function(t,e){l.getShapeStyleAsync(t,o.id).then(e=>t.setStyle(e))}:o.style?(i=o.style,o.style=function(e,t){return l.mapStyleOptionsToStyle(i)}):o.flatStyle&&(o.style=o.flatStyle),o.source.data&&(a=o.source.format.readFeatures(o.source.data,{featureProjection:this.Options.viewProjection??(0<c.length?c[0].getSource().getProjection():l.Map?l.Map.getView().getProjection():"EPSG:3857"),dataProjection:o.source.projection??this.Options.coordinatesProjection})),o.source=new("VectorTile"==o.layerType?ol.source.VectorTile:ol.source.Vector)(o.source),o.raiseShapeEvents&&(o.source.on("addfeature",function(e){l.onFeatureAdded(o.id,e.feature)}),o.source.on("changefeature",function(e){l.onFeatureChanged(o.id,e.feature)}),o.source.on("removefeature",function(e){l.onFeatureRemoved(o.id,e.feature)})),a&&o.source.addFeatures(a),n=new("VectorTile"==o.layerType?ol.layer.VectorTile:ol.layer.Vector)(o);break;case"Heatmap":o.source=new ol.source.Vector(o.source),n=new ol.layer.Heatmap(o);break;case"Graticule":null==o.showLabels&&(o.showLabels=!0),null==o.wrapX&&(o.wrapX=!1),delete o.source,n=new ol.layer.Graticule(o);break;case"VectorImage":o.source=new ol.source.Vector(o.source),n=new ol.layer.VectorImage(o);break;case"WebGLTile":o.source=e,n=new ol.layer.WebGLTile(o);break;case"MapboxVectorStyle":o.styleUrl=o.source.url,o.source=o.source.layer,n=new olms.MapboxVectorLayer(o);break;default:o.source=e,n=new ol.layer.Tile(o)}c.push(n)}catch(e){console.error("Could no add layer: "+e)}}),c},MapOL.prototype.getLayer=function(t){return this.Map.getAllLayers().find(e=>e.get("id")==t)},MapOL.prototype.setLayers=function(e){this.Map.setLayers(this.prepareLayers(e))},MapOL.prototype.removeLayer=function(e){this.Map.removeLayer(this.getLayer(e))},MapOL.prototype.addLayer=function(e){e=this.prepareLayers([e]);this.Map.addLayer(e[0])},MapOL.prototype.updateLayer=function(t){var e=this.Map.getAllLayers().find(e=>e.get("id")==t.id);null!=e&&(e.setVisible(t.visibility),e.setOpacity(t.opacity),e.setZIndex(t.zindex),e.setExtent(t.extent))},MapOL.prototype.getShapesLayer=function(){return this.getLayer("shapes")},MapOL.prototype.getMarkersLayer=function(){return this.getLayer("markers")},MapOL.prototype.setShapes=function(e,t){var o=this.getLayer(e).getSource();o.clear(),t&&t.forEach(e=>{e=this.mapShapeToFeature(e,o);o.addFeature(e)})},MapOL.prototype.setZoom=function(e){this.Map.getView().setZoom(e)},MapOL.prototype.setZoomToExtent=function(e,t){null==t&&(t=void 0);e=this.getLayer(e).getSource().getExtent();e[0]!==1/0&&this.Map.getView().fit(e,{size:this.Map.getSize(),padding:t})},MapOL.prototype.setCenter=function(e){this.Map.getView().setCenter(ol.proj.transform(e,this.Options.coordinatesProjection,this.Map.getView().getProjection()))},MapOL.prototype.setRotation=function(e){this.Map.getView().setRotation(e)},MapOL.prototype.setOptions=function(e){this.Options=e},MapOL.prototype.setInteractions=function(r){this.Map.getInteractions().forEach((e,t,o)=>{e.setActive(r)}),r?0==this.Map.getControls().getLength()&&this.addControls():this.Map.getControls().clear()},MapOL.prototype.addControls=function(){this.Options.zoomControl&&this.Map.addControl(new ol.control.Zoom),this.Options.attributionControl&&this.Map.addControl(new ol.control.Attribution),this.Options.fullScreenControl&&this.Map.addControl(new ol.control.FullScreen),this.Options.zoomSliderControl&&this.Map.addControl(new ol.control.ZoomSlider),this.Options.rotateControl&&this.Map.addControl(new ol.control.Rotate),"None"!=this.Options.scaleLineUnit&&this.Map.addControl(new ol.control.ScaleLine({units:this.Options.scaleLineUnit.toLowerCase()})),this.Options.overviewMap&&this.Map.addControl(new ol.control.OverviewMap({layers:[new ol.layer.Tile(layers[0])]})),this.Options.zoomToExtentControl&&this.Map.addControl(new ol.control.ZoomToExtent)},MapOL.prototype.getReducedFeature=function(e){e.getGeometry().getType();var t=((e,t)=>{let{[t]:o,...r}=e;return r})(e.getProperties(),"geometry");return{type:"Feature",geometry:{type:e.getGeometry().getType(),coordinates:e.getGeometry().getCoordinates()},properties:t}},MapOL.prototype.onMapClick=function(e,n,t){n.setPosition(0,0);var a=this,o=ol.proj.transform(e.coordinate,this.Map.getView().getProjection(),this.Options.coordinatesProjection);this.Instance.invokeMethodAsync("OnInternalClick",o),this.Map.forEachFeatureAtPixel(e.pixel,function(e,t){var o,r;t&&(t=t.get("id"),ol.Feature.prototype.isPrototypeOf(e)?((o=a.mapFeatureToShape(e))&&a.Instance.invokeMethodAsync("OnInternalShapeClick",o,t),r=!1,(r=null==(r=o?o.properties.popup:r)?a.Options.autoPopup:r)&&(o=e.getGeometry().getCoordinates(),n.setPosition(o))):ol.render.Feature.prototype.isPrototypeOf(e)&&((r=a.mapFeatureToInternalFeature(e))&&a.Instance.invokeMethodAsync("OnInternalFeatureClick",r,t),a.Options.autoPopup)&&n.setPosition(r.coordinates))})},MapOL.prototype.onMapDblClick=function(e){e=ol.proj.transform(e.coordinate,this.Map.getView().getProjection(),this.Options.coordinatesProjection);this.Instance.invokeMethodAsync("OnInternalDoubleClick",e)},MapOL.prototype.showPopup=function(e){this.OverlayPopup.setPosition(ol.proj.transform(e,this.Options.coordinatesProjection,this.Map.getView().getProjection()))},MapOL.prototype.onMapPointerMove=function(e){var t,o,r;e.dragging||Number.isNaN(e.coordinate[0])||(t=ol.proj.transform(e.coordinate,this.Map.getView().getProjection(),this.Options.coordinatesProjection),this.Instance.invokeMethodAsync("OnInternalPointerMove",t),r=o=null,this.Map.forEachFeatureAtPixel(e.pixel,function(e,t){t&&(e=e.getId())&&(t=t.get("id"),o||(o=e.toString(),r=t))}),this._hoverFeatureId==o&&this._hoverLayerId==r)||(this.Instance.invokeMethodAsync("OnInternalShapeHover",r,o),this._hoverFeatureId=o,this._hoverLayerId=r)},MapOL.prototype.onMapResolutionChanged=function(){this.Instance.invokeMethodAsync("OnInternalZoomChanged",this.Map.getView().getZoom()),this.onVisibleExtentChanged()},MapOL.prototype.onMapCenterChanged=function(){var e=this.Map.getView().getCenter();e&&(e=ol.proj.transform(e,this.Map.getView().getProjection(),this.Options.coordinatesProjection),this.Instance.invokeMethodAsync("OnInternalCenterChanged",e),this.onVisibleExtentChanged())},MapOL.prototype.onMapRotationChanged=function(){var e=this.Map.getView().getRotation();e&&this.Instance.invokeMethodAsync("OnInternalRotationChanged",e)},MapOL.prototype.onVisibleExtentChanged=function(){var e,t;this.disableVisibleExtentChanged||(e=this.Map.getView().calculateExtent(this.Map.getSize()),t=ol.proj.transform([e[0],e[1]],this.Map.getView().getProjection(),this.Options.coordinatesProjection),e=ol.proj.transform([e[2],e[3]],this.Map.getView().getProjection(),this.Options.coordinatesProjection),t={X1:t[0],Y1:t[1],X2:e[0],Y2:e[1]},this.Instance.invokeMethodAsync("OnInternalVisibleExtentChanged",t))},MapOL.prototype.centerToCurrentGeoLocation=function(){var o=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=o.Map.getView().getProjection().getCode();o.Map.getView().setCenter(ol.proj.transform([e.coords.longitude,e.coords.latitude],"EPSG:4326",t))})},MapOL.prototype.getCurrentGeoLocation=function(){var r=this;return new Promise((o,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t=r.Map.getView().getProjection().getCode(),e=ol.proj.transform([e.coords.longitude,e.coords.latitude],"EPSG:4326",t);o(e)}):e("No geolocation received")})},MapOL.prototype.disableVisibleExtentChranged=!1,MapOL.prototype.setVisibleExtent=function(e){this.disableVisibleExtentChanged=!0;var t=this.Map.getView().getProjection(),e=ol.proj.transformExtent(new Array(e.x1,e.y1,e.x2,e.y2),this.Options.coordinatesProjection,t);this.Map.getView().fit(e,this.Map.getSize()),this.disableVisibleExtentChanged=!1},MapOL.prototype.currentDraw=null,MapOL.prototype.currentSnap=null,MapOL.prototype.currentModify=null,MapOL.prototype.setDrawingSettings=function(e,t,o,r,n,a){var i=this,s=(this.removeDrawingInteractions(),this.getLayer(e).getSource());o&&null==this.currentModify&&(this.currentModify=new ol.interaction.Modify({source:s}),this.Map.addInteraction(this.currentModify)),t&&(this.currentDraw=new ol.interaction.Draw({source:s,type:n,freehand:a}),this.currentDraw.on("drawend",function(t){i.getShapeStyleAsync(t.feature,"geometries").then(e=>t.feature.setStyle(e)),i.onFeatureAdded(e,t.feature)}),this.Map.addInteraction(this.currentDraw)),r&&(this.currentSnap=new ol.interaction.Snap({source:s}),this.Map.addInteraction(this.currentSnap))},MapOL.prototype.removeDrawingInteractions=function(){this.currentDraw&&(this.Map.removeInteraction(this.currentDraw),this.currentDraw=null),this.currentSnap&&(this.Map.removeInteraction(this.currentSnap),this.currentSnap=null),this.currentModify&&(this.Map.removeInteraction(this.currentModify),this.currentModify=null)},MapOL.prototype.undoDrawing=function(){this.currentDraw&&this.currentDraw.removeLastPoint()},MapOL.prototype.currentSelection=null,MapOL.prototype.setSelectionSettings=function(r,e,t,o){var n=this,a=new ol.style.Style({fill:new ol.style.Fill({color:"#eeeeeeaa"}),stroke:new ol.style.Stroke({color:"rgba(67, 141, 239, 0.7)",width:5})});e?(this.currentSelection=new ol.interaction.Select({condition:ol.events.condition.click,style:function(e){return t?n.mapStyleOptionsToStyle(t):(e=e.get("COLOR")||"#eeeeeeaa",a.getFill().setColor(e),a)},layers:r?[this.getLayer(r)]:void 0,multi:o}),this.currentSelection.on("select",function(e){var t=new Array,o=(e.selected&&e.selected.forEach(e=>t.push(n.mapFeatureToShape(e))),new Array);e.unselected&&e.unselected.forEach(e=>o.push(n.mapFeatureToShape(e))),n.Instance.invokeMethodAsync("OnInternalSelectionChanged",r,t,o)}),this.Map.addInteraction(this.currentSelection)):this.currentSelection&&(this.Map.removeInteraction(this.currentSelection),this.currentSelection=null)},MapOL.prototype.onFeatureAdded=function(e,t){t=this.mapFeatureToShape(t);this.Instance.invokeMethodAsync("OnInternalShapeAdded",e,t)},MapOL.prototype.mapFeatureToShape=function(e){var t,o,r,n,a,i;return null==e?null:(t=e.getGeometry(),a=this.Map?this.Map.getView().getProjection():this.Options.viewProjection??"EPSG:3857",(o=null)==t||Array.isArray(t)||("Circle"===t.getType()?o=ol.proj.transform(t.getCenter(),a,this.Options.coordinatesProjection):(i=t.getCoordinates(),r=i.length,Array.isArray(i[0])&&i.forEach(e=>r+=e.length),r<this.Options.serializationCoordinatesLimit&&(o=MapOL.transformCoordinates(i,a,this.Options.coordinatesProjection)))),"function"==typeof(i=e.getStyle())&&(i=i(e,this.Map.getView().getResolution())),n=new Array,Array.isArray(i)?i.forEach(e=>n.push(this.mapStylesToStyleOptions(e))):i&&(n=[this.mapStylesToStyleOptions(i)]),null==(a=e.getId())?(a=self.crypto.randomUUID(),e.setId(a)):a=a.toString(),(i=((e,t)=>{let{[t]:o,...r}=e;return r})(e.getProperties(),"geometry")).type||(i.type="Shape"),e={id:a,geometryType:t?t.getType():"None",coordinates:o,properties:i,styles:n},t&&"Circle"==t.getType()&&t.getRadius&&(e.radius=t.getRadius()),e)},MapOL.prototype.mapFeatureToInternalFeature=function(e){var t,o,r,n;return null==e?null:(n=this.Map?this.Map.getView().getProjection():this.Options.viewProjection??"EPSG:3857",t=null,r=e.getFlatCoordinates(),o=r.length,Array.isArray(r[0])&&r.forEach(e=>o+=e.length),o<this.Options.serializationCoordinatesLimit&&(t=MapOL.transformCoordinates(r,n,this.Options.coordinatesProjection)),r=e.getId()??e.getProperties().feature_id,(n=e.getProperties()).type=e.getType(),{id:r?r.toString():null,coordinates:t,properties:n})},MapOL.prototype.mapShapeToFeature=function(e,t=null,o=!0){var r,n=this.Map.getView().getProjection(),t=t?t.getProjection():null;if(e.coordinates){var a=o?MapOL.transformCoordinates(e.coordinates,t??this.Options.coordinatesProjection,n):e.coordinates;switch(e.geometryType){case"Point":r=new ol.geom.Point(a);break;case"LineString":r=new ol.geom.LineString(a);break;case"Polygon":r=new ol.geom.Polygon(a);break;case"Circle":r=new ol.geom.Circle(a,e.radius/ol.proj.getPointResolution(n,1,a));break;case"MultiPoint":r=new ol.geom.MultiPoint(a);break;case"MultiLineString":r=new ol.geom.MultiLineString(a);break;case"MultiPolygon":r=new ol.geom.MultiPolygon(a)}}var i,o=new ol.Feature({type:e.properties.type,popup:e.properties.popup,markerstyle:e.properties.markerstyle});return o.setId(e.id),r&&o.setGeometry(r),e.styles&&(Array.isArray(e.styles)?(i=new Array,e.styles.forEach(e=>i.push(this.mapStyleOptionsToStyle(e))),o.setStyle(i)):o.setStyle(this.mapStyleOptionsToStyle(e.styles))),e.flatStyle&&o.setStyle(e.flatStyle),o},MapOL.prototype.onFeatureRemoved=function(e,t){t=this.mapFeatureToShape(t);this.Instance.invokeMethodAsync("OnInternalShapeRemoved",e,t)},MapOL.prototype.onFeatureChanged=function(e,t){t=this.mapFeatureToShape(t);this.Instance.invokeMethodAsync("OnInternalShapeChanged",e,t)},MapOL.prototype.updateShape=function(e,t){var o,e=this.getLayer(e).getSource().getFeatureById(t.id);e&&((o=(t=this.mapShapeToFeature(t)).getGeometry())&&e.setGeometry(o),e.setStyle(t.getStyle()))},MapOL.prototype.removeShape=function(t,e){var o=this.Map.getAllLayers().find(e=>e.get("id")==t).getSource(),e=o.getFeatureById(e.id);e&&o.removeFeature(e)},MapOL.prototype.addShape=function(t,e){var o=this.Map.getAllLayers().find(e=>e.get("id")==t).getSource(),e=this.mapShapeToFeature(e,o);o.addFeature(e)},MapOL.prototype.getCoordinates=function(t,e){t=this.getLayer(t).getSource().getFeatureById(e);if(t){let e=t.getGeometry().getCoordinates();return e=e||t.getGeometry().getCenter()}return null},MapOL.prototype.setCoordinates=function(e,t,o){var r,t=this.getLayer(e).getSource().getFeatureById(t);null!=t&&(t=t.getGeometry(),r=this.Map.getView().getProjection(),e=this.getLayer(e).getSource().getProjection(),o=MapOL.transformCoordinates(o,e??this.Options.coordinatesProjection,r),"Circle"==t.getType()?t.setCenter(o):t.setCoordinates(o))},MapOL.prototype.getShapeStyleAsync=async function(e,t){e=ol.render.Feature.prototype.isPrototypeOf(e)?this.mapFeatureToInternalFeature(e):this.mapFeatureToShape(e),delete e.coordinates,t=await this.Instance.invokeMethodAsync("OnGetShapeStyleAsync",e,t);return this.mapStyleOptionsToStyle(t,e.geometryType)},MapOL.prototype.getShapeStyle=function(e,t){e=ol.render.Feature.prototype.isPrototypeOf(e)?this.mapFeatureToInternalFeature(e):this.mapFeatureToShape(e),delete e.coordinates,t=this.Instance.invokeMethod("OnGetShapeStyle",e,t);return this.mapStyleOptionsToStyle(t,e.geometryType)},MapOL.prototype.mapStyleOptionsToStyle=function(e,t=null){(e=MapOL.transformNullToUndefined(e)).icon&&e.icon.shapeSource&&(o=document.createElement("canvas"),n=ol.render.toContext(o.getContext("2d"),{size:e.icon.size,pixelRatio:1}),r=this.mapShapeToFeature(e.icon.shapeSource,null,!1),n.setStyle(r.getStyle()[0]),n.drawGeometry(r.getGeometry()),e.icon.img=o),e.icon&&e.icon.scale&&(e.icon.width=void 0,e.icon.height=void 0),e.circle&&(e.circle.fill&&(e.circle.fill=new ol.style.Fill(e.circle.fill)),e.circle.stroke)&&(e.circle.stroke=new ol.style.Stroke(e.circle.stroke)),e.text&&(e.text.fill&&(e.text.fill=new ol.style.Fill(e.text.fill)),e.text.stroke&&(e.text.stroke=new ol.style.Stroke(e.text.stroke)),e.text.backgroundFill&&(e.text.backgroundFill=new ol.style.Fill(e.text.backgroundFill)),e.text.backgroundStroke)&&(e.text.backgroundStroke=new ol.style.Stroke(e.text.backgroundStroke)),"Point"!=t||e.circle||(e.circle={fill:new ol.style.Fill(e.fill),stroke:new ol.style.Stroke(e.stroke),radius:2*e.stroke.width});var o,r,n=new ol.style.Style({stroke:e.stroke?new ol.style.Stroke(e.stroke):void 0,fill:e.fill?new ol.style.Fill(e.fill):void 0,text:e.text?new ol.style.Text(e.text):void 0,image:e.circle?new ol.style.Circle(e.circle):e.icon?new ol.style.Icon(e.icon):void 0,zIndex:e.zIndex});return n},MapOL.prototype.mapStylesToStyleOptions=function(e){var t,o,r=e.getImage(),n=e.getFill(),a=e.getStroke(),i=e.getText();return r&&r.getSrc&&(t=r),r&&r.getRadius&&(o=r),{fill:n?{color:n.getColor()}:void 0,stroke:a?{color:a.getColor(),lineCap:a.getLineCap(),lineJoin:a.getLineJoin(),lineDash:a.getLineDash(),lineDashOffset:a.getLineDashOffset(),miterLimit:a.getMiterLimit(),width:a.getWidth()}:void 0,text:i?{font:i.getFont(),maxAngle:i.getMaxAngle(),offsetX:i.getOffsetX(),offsetY:i.getOffsetY(),overflow:i.getOverflow(),placement:i.getPlacement(),repeat:i.getRepeat(),scale:i.getScale(),rotateWithView:i.getRotateWithView(),rotation:i.getRotation(),text:i.getText(),textAlign:i.getTextAlign(),justify:i.getJustify(),textBaseline:i.getTextBaseline(),fill:i.getFill()?{color:i.getFill().getColor()}:void 0,backgroundFill:i.getBackgroundFill()?{color:i.getBackgroundFill().getColor()}:void 0,stroke:i.getStroke()?{color:i.getStroke().getColor(),lineCap:i.getStroke().getLineCap(),lineJoin:i.getStroke().getLineJoin(),lineDash:i.getStroke().getLineDash(),lineDashOffset:i.getStroke().getLineDashOffset(),miterLimit:i.getStroke().getMiterLimit(),width:i.getStroke().getWidth()}:void 0,backgroundStroke:i.getBackgroundStroke()?{color:i.getBackgroundStroke().getColor(),lineCap:i.getBackgroundStroke().getLineCap(),lineJoin:i.getBackgroundStroke().getLineJoin(),lineDash:i.getBackgroundStroke().getLineDash(),lineDashOffset:i.getBackgroundStroke().getLineDashOffset(),miterLimit:i.getBackgroundStroke().getMiterLimit(),width:i.getBackgroundStroke().getWidth()}:void 0,backgroundFill:i.getBackgroundFill()?{color:i.getBackgroundFill().getColor()}:void 0,padding:i.getPadding()}:void 0,circle:o?{radius:o.getRadius(),fill:o.fill?{color:o.fill.getColor()}:void 0,rotation:o.getRotation(),rotateWithView:o.getRotateWithView(),declutterMode:o.getDeclutterMode(),displacement:o.getDisplacement(),stroke:o.stroke?{color:o.stroke.getColor(),lineCap:o.stroke.getLineCap(),lineJoin:o.stroke.getLineJoin(),lineDash:o.stroke.getLineDash(),lineDashOffset:o.stroke.getLineDashOffset(),miterLimit:o.stroke.getMiterLimit(),width:o.stroke.getWidth()}:void 0}:void 0,icon:t?{anchor:t.getAnchor(),color:t.getColor(),declutterMode:t.getDeclutterMode(),height:t.getHeight(),opacity:t.getOpacity(),rotation:t.getRotation(),rotateWithView:t.getRotateWithView(),scale:t.getScale(),size:t.getSize(),width:t.getWidth(),src:t.getSrc()}:void 0,zIndex:e.getZIndex()}},MapOL.prototype.applyMapboxStyle=function(e,t){var o=this;this.Map.getAllLayers().forEach(e=>{o.Map.removeLayer(e)}),olms.apply(this.Map,e,{accessToken:t}).then(function(e){})},MapOL.transformNullToUndefined=function e(t){for(var o in t)t.hasOwnProperty(o)&&null===t[o]?t[o]=void 0:"object"==typeof t[o]&&e(t[o]);return t},MapOL.transformCoordinates=function(o,r,n){var a;if(r===n)return o;if(Array.isArray(o)&&Array.isArray(o[0])){a=Array(o.length);for(let t=0;t<o.length;t++)if(Array.isArray(o[t][0])){a[t]=Array(o[t].length);for(let e=0;e<o[t].length;e++)a[t][e]=ol.proj.transform(o[t][e],r,n)}else a[t]=ol.proj.transform(o[t],r,n)}else a=ol.proj.transform(o,r,n);return a},MapOL.WGStoLV03y=function(e,t){e=DECtoSEX(e),t=DECtoSEX(t);e=((e=DEGtoSEC(e))-169028.66)/1e4,t=((t=DEGtoSEC(t))-26782.5)/1e4;return 600072.37+211455.93*t-10938.51*t*e-.36*t*Math.pow(e,2)-44.54*Math.pow(t,3)},MapOL.WGStoLV03x=function(e,t){e=DECtoSEX(e),t=DECtoSEX(t);e=((e=DEGtoSEC(e))-169028.66)/1e4,t=((t=DEGtoSEC(t))-26782.5)/1e4;return 200147.07+308807.95*e+3745.25*Math.pow(t,2)+76.63*Math.pow(e,2)-194.56*Math.pow(t,2)*e+119.79*Math.pow(e,3)},MapOL.CHtoLV03lat=function(e,t){e=(e-6e5)/1e6,t=(t-2e5)/1e6;return 100*(16.9023892+3.238272*t-.270978*Math.pow(e,2)-.002528*Math.pow(t,2)-.0447*Math.pow(e,2)*t-.014*Math.pow(t,3))/36},MapOL.CHtoLV03lng=function(e,t){e=(e-6e5)/1e6,t=(t-2e5)/1e6;return 100*(2.6779094+4.728982*e+.791484*e*t+.1306*e*Math.pow(t,2)-.0436*Math.pow(e,3))/36},MapOL.DECtoSEX=function(e){var t=parseInt(e,10),o=parseInt(60*(e-t),10);return t+o/100+60*(60*(e-t)-o)/1e4},MapOL.DEGtoSEC=function(e){var t=parseInt(e,10);let o=parseInt(100*(e-t),10),r=100*(100*(e-t)-o);e=String(e).split(".");return 2==e.length&&2==e[1].length&&(o=Number(e[1]),r=0),r+60*o+3600*t},MapOL.WGStoLV95y=function(e,t){e=(3600*e-169028.66)/1e4,t=(3600*t-26782.5)/1e4;return 2600072.37+211455.93*t-10938.51*t*e-.36*t*(e*e)-44.54*(t*t*t)},MapOL.WGStoLV95x=function(e,t){var e=(3600*e-169028.66)/1e4,o=e*e,t=(3600*t-26782.5)/1e4,t=t*t;return 1200147.07+308807.95*e+3745.25*t+76.63*o-194.56*t*e+119.79*(o*e)},MapOL.LV95toWGSlat=function(e,t){var t=(t-12e5)/1e6,o=t*t,e=(e-26e5)/1e6,e=e*e;return 100*(16.9023892+3.238272*t-.270978*e-.002528*o-.0447*e*t-.014*(o*t))/36},MapOL.LV95toWGSlng=function(e,t){t=(t-12e5)/1e6,e=(e-26e5)/1e6;return 100*(2.6779094+4.728982*e+.791484*e*t+.1306*e*(t*t)-.0436*(e*e*e))/36};export{MapOLInit,MapOLDispose,MapOLCenter,MapOLRotate,MapOLZoom,MapOLSetOptions,MapOLZoomToExtent,MapOLSetShapes,MapOLCenterToCurrentGeoLocation,MapOLGetCurrentGeoLocation,MapOLSetLayers,MapOLRemoveLayer,MapOLAddLayer,MapOLUpdateLayer,MapOLSetVisibleExtent,MapOLSetDrawingSettings,MapOLUndoDrawing,MapOLUpdateShape,MapOLRemoveShape,MapOLAddShape,MapOLGetCoordinates,MapOLSetCoordinates,MapOLSetInteractions,MapOLSetSelectionSettings,MapOLShowPopup,MapOLApplyMapboxStyle};